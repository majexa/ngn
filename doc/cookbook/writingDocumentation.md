#Пишем документацию к php библиотеке#

__Задача:__ Составить документацию к библиотеке

__Библиотека__ — это класс или набор классов, выполняющих одну бизнес-задачу

##Преамбула##

Если вы работали хоть раз в команде, даже если это был один ваш коллега, то наверняка
сталкивались с просьбой написать документацию к вашему коду. Конечно матёрому
разрабу будет вполне достаточно посмотреть какое-то количество времени на ваш код,
что бы составить композицию, а вернее декомпозицию. Возможно логика вашей библиотеки
разбита на небольшие методы (от 1 до 5 строк каждый), имена этих методов определяют смысл
выполняемой задачи. Тогда последовательно перемещаясь от публичных методов
к самым недрам кода, не составит труда даже для новичка понять что же и как делает
ваше приложение. Но программисты народ ленивый. Пока вы не разложите на блюдичке с голубой
коёмочкой всё, что приготовили. Пока вы не покажете наглядные примеры, как
можно всё это использовать. Пока вы не сделаете это, они будут дуться, ворчать и 
поминать вас самыми скверными словами. Только потому, что кто-то другой уже написал
что-то похожее и он не поленился презентовать это должным образом. Так давайте и мы
сделаем этот шаг. Тем более не так страшен чёрт, как его малюют.

В начале определим уровнь детализации нашей доки. Для кого мы её пишем?
Это будет урок по приготовлению красочного API для использования библиотеки «из коробки».

Документация не будет описывать:

 - возможности для модификации библиотеки
 - API защищенных методов

##Начало##

Определившись с уровнем детализации, теперь нужно понять из каких составных
частей она будет состоять. Для 

Если ваша библиотека имеет набор классов, то хорошей практикой будет оставить
один "корневой" класс для уровня API. Т.е. пользовательском уровне на котором с 
библиотекой будет взаимодействовать сторонний разработчик.
В этом классе будут собраны все публичные методы,
с помощью которых производится манипуляция с библиотекой.

Даже если такого класса
нет, а логика вашей библиотеки собрана в одном классе. Даже если все методы
этого класса имеют публичную область видимости, быдь может вы фанат php4-стиля.
В любом случае вы должны определить тот набор методов, который будет достаточен
для выполнения конечного набора бизнес-задач библиотеки. Это и есть уровень API.

И так, выделяются два ключевых элемента документации — _класс_ и _метод_. Теперь нужно рассмотреть
их с пользовательской стороны. Какие практики помогут понять как их использовать.
Рассмотрим их по очереди.

###Элементы документации класса и метода###

 * __Сигнатура__. Описание всех аргументов сущности с указанием их типов
 * __Описание__. Суть логики метода на человеческом языке
 * __Аргументы__. Описание каждого аргумента в отдельности на человеческом языке
 * __Опции__. Если в методе используется переменное количество аргументов, то для
   этого удобно использовать массив значений, где ключ элемента — это имя опции.
 * __Возвращаемое значение__. Тип и описание возвращаемого значения на человеческом языке
 * __Примеры__. Пожалуй самый главный пунк, способный быстрее всего показать суть задачи
   метода. Но это конечно зависит от качества примера.
 * __Заметки__. Всё то, что не имеет прямого отношение к логики метода. Подводные камни,
   особое поведение на каких-то операционных системах и прочее.

Ну а теперь самое главное. Приступим к процессу написания доки творчески. Напишем документацию
к генератору документаций, который сейчас и напишем. Рекурсия детектед!

##Пишем код##

В этой главе мы будем писать код для генерации текста каждого пункта, описанного выше.
Посмотрим сразу на часть класса, который мы будем документировать:

    class DocBlocksClassPhp extends ArrayAccesseble {
      function __construct($class, $onlyApiDocs = true) {
        $this->r = [...];
      }
    }

^ Класс использует ООП-шаблон `ArrayAccesseble`, позволяющий работать с экземпляром класса,
как с массивом.

Начнем писать документацию. Прямо в коде, используя стандарт [phpDoc](http://phpdoc.org), поддерживаемый
большинством современных IDE. А для того, что бы наша документация была удобной и понятной,
мы расширим стандарт, дополнив его недостающим синтаксисом.

В этом классе вообще нет методов (кроме конструктора). Все данные (`$this->r`)
создаются в конструкторе и становятся доступны в экземпляре, как элементы массива.

Как же описать их. Раз данные принадлежат самому экземпляру класса, а не возвращаются методом,
то нужно и описывать их в классе.

Вот пример массива данных:

    [
      [
        'class' => 'ClassName',
        'method' => 'methodName',
        'title' => 'Method Title',
        'api' => $api
      ],
      ...
    ]

phpDoc не имеет поддержки документирования ассоциативных массивов. Так что придумаем собственный формат для их
описания в комментариях кода. А после напишем парсер этого формата для оформления в доке.

###Ассоциативные массивы в комментариях###

Всё, что может дать нам phpDoc на данном этапе - это описание свойства класса. Как видим мало полезного.

    /**
     * @property array $r Структура данных
     */

Добавим данные по ключам:

    /**
     * @property array $r Структура данных
     * -
     *   - string class Класс
     *   - string method Метод 
     *   - title string Описание метода
     */

Я использовал YAML формат для описания массива массивов, что бы не нужно было придумывать парсер.

###Пишем парсер комментария###


